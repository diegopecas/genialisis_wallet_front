<div class="tab-content">
  <!-- FILTROS -->
  <div class="filters-card">
    <h2 class="filters-title">ðŸ“Š Filtros</h2>

    <form [formGroup]="filtrosForm" class="filters-form">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">AÃ±o</label>
          <select formControlName="anio" class="form-select">
            <option *ngFor="let anio of anios" [value]="anio">{{ anio }}</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Mes</label>
          <select formControlName="mes" class="form-select">
            <option [value]="null">Todos</option>
            <option *ngFor="let mes of meses" [value]="mes.value">{{ mes.nombre }}</option>
          </select>
        </div>
      </div>
    </form>
  </div>
  
  <!-- CARDS DE BALANCE -->
  <div class="balance-cards">
    <div class="balance-card income">
      <div class="balance-label">ðŸ’° Total Ingresos</div>
      <div class="balance-value">{{ formatearValor(balance.total_ingresos) }}</div>
    </div>

    <div class="balance-card expense">
      <div class="balance-label">ðŸ’¸ Total Gastos</div>
      <div class="balance-value">{{ formatearValor(balance.total_gastos) }}</div>
    </div>

    <div class="balance-card net" [class.negative]="balance.balance_neto < 0">
      <div class="balance-label">ðŸŽ¯ Balance Neto</div>
      <div class="balance-value">{{ formatearValor(balance.balance_neto) }}</div>
    </div>
  </div>
  
  <!-- TOTALES POR DÃA -->
  <div class="totales-dia-section" *ngIf="!loading && totalesPorDia && totalesPorDia.length > 0">
    <h3 class="section-title">ðŸ“… Totales por DÃ­a</h3>

    <div class="dia-item" *ngFor="let dia of totalesPorDia">
      <div class="dia-fecha">
        <span class="fecha-icon">ðŸ“…</span>
        <span class="fecha-text">{{ dia.fecha | date:'dd/MM/yyyy' }}</span>
      </div>
      <div class="dia-totales">
        <div class="dia-total income">
          <span class="total-label">ðŸ’°</span>
          <span class="total-value">{{ formatearValor(dia.total_ingresos) }}</span>
          <span class="total-count">({{ dia.cantidad_ingresos }})</span>
        </div>
        <div class="dia-total expense">
          <span class="total-label">ðŸ’¸</span>
          <span class="total-value">{{ formatearValor(dia.total_gastos) }}</span>
          <span class="total-count">({{ dia.cantidad_gastos }})</span>
        </div>
      </div>
    </div>
  </div>

  <!-- TOTALES POR CATEGORÃA -->
  <div class="totales-categoria-section" *ngIf="!loading">
    <!-- INGRESOS -->
    <div class="categoria-card" *ngIf="categoriaIngresos && categoriaIngresos.length > 0">
      <h3 class="categoria-title income">ðŸ’° Ingresos por CategorÃ­a</h3>
      <div class="categoria-list">
        <div class="categoria-item" *ngFor="let cat of categoriaIngresos">
          <div class="categoria-info">
            <span class="categoria-icon">{{ cat.categoria_icono }}</span>
            <div class="categoria-text">
              <div class="categoria-name">{{ cat.categoria_nombre }}</div>
              <div class="categoria-count">{{ cat.cantidad }} movimiento(s)</div>
            </div>
          </div>
          <div class="categoria-value income">{{ formatearValor(cat.total) }}</div>
        </div>
      </div>
    </div>

    <!-- GASTOS -->
    <div class="categoria-card" *ngIf="categoriaGastos && categoriaGastos.length > 0">
      <h3 class="categoria-title expense">ðŸ’¸ Gastos por CategorÃ­a</h3>
      <div class="categoria-list">
        <div class="categoria-item" *ngFor="let cat of categoriaGastos">
          <div class="categoria-info">
            <span class="categoria-icon">{{ cat.categoria_icono }}</span>
            <div class="categoria-text">
              <div class="categoria-name">{{ cat.categoria_nombre }}</div>
              <div class="categoria-count">{{ cat.cantidad }} movimiento(s)</div>
            </div>
          </div>
          <div class="categoria-value expense">{{ formatearValor(cat.total) }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- DETALLE POR CONCEPTO -->
  <div class="detail-section" *ngIf="!loading">
    <!-- INGRESOS -->
    <div class="detail-card" *ngIf="detalleIngresos && detalleIngresos.length > 0">
      <h3 class="detail-title income">ðŸ’° Detalle Ingresos por Concepto</h3>
      <div class="detail-list">
        <div class="detail-item" *ngFor="let detalle of detalleIngresos">
          <div class="detail-info">
            <span class="detail-icon">{{ detalle.concepto_icono }}</span>
            <div class="detail-text">
              <div class="detail-name">{{ detalle.concepto_nombre }}</div>
              <div class="detail-categoria">{{ detalle.categoria_nombre }}</div>
              <div class="detail-count">{{ detalle.cantidad }} movimiento(s)</div>
            </div>
          </div>
          <div class="detail-value income">{{ formatearValor(detalle.total) }}</div>
        </div>
      </div>
    </div>

    <!-- GASTOS -->
    <div class="detail-card" *ngIf="detalleGastos && detalleGastos.length > 0">
      <h3 class="detail-title expense">ðŸ’¸ Detalle Gastos por Concepto</h3>
      <div class="detail-list">
        <div class="detail-item" *ngFor="let detalle of detalleGastos">
          <div class="detail-info">
            <span class="detail-icon">{{ detalle.concepto_icono }}</span>
            <div class="detail-text">
              <div class="detail-name">{{ detalle.concepto_nombre }}</div>
              <div class="detail-categoria">{{ detalle.categoria_nombre }}</div>
              <div class="detail-count">{{ detalle.cantidad }} movimiento(s)</div>
            </div>
          </div>
          <div class="detail-value expense">{{ formatearValor(detalle.total) }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- GRÃFICO -->
  <div class="chart-card" *ngIf="mostrarGrafico && !loading">
    <h3 class="chart-title">ðŸ“ˆ EvoluciÃ³n Mensual</h3>
    <div class="chart-container">
      <canvas #chartCanvas></canvas>
    </div>
  </div>
  
  <!-- GRÃFICO DE BARRAS POR CATEGORÃA -->
  <div class="chart-card" *ngIf="!loading && datosGraficoCategoria && datosGraficoCategoria.length > 0">
    <h3 class="chart-title">ðŸ“Š Ingresos y Gastos por CategorÃ­a</h3>
    <div class="chart-container">
      <canvas #chartBarrasCanvas></canvas>
    </div>
  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="loading-message">Cargando datos...</div>
</div>