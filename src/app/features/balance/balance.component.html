<div class="tab-content">
  <!-- CARDS DE BALANCE PRINCIPAL -->
  <div class="balance-summary-card">
    <h2 class="balance-summary-title">ðŸ’¼ Resumen del PerÃ­odo: {{ periodoTexto }}</h2>
    
    <!-- Primera fila: Saldo anterior y movimientos del perÃ­odo -->
    <div class="balance-cards">
      <div class="balance-card previous">
        <div class="balance-label">ðŸ’¼ Saldo Anterior</div>
        <div class="balance-value" [class.negative]="(balance.saldo_anterior || 0) < 0">
          {{ formatearValor(balance.saldo_anterior || 0) }}
        </div>
        <div class="balance-sublabel" *ngIf="saldoAnteriorData">
          Acumulado hasta {{ saldoAnteriorData.fecha_corte | date:'dd/MM/yyyy' }}
        </div>
      </div>

      <div class="balance-card income">
        <div class="balance-label">ðŸ’° Ingresos del PerÃ­odo</div>
        <div class="balance-value">{{ formatearValor(balance.total_ingresos) }}</div>
      </div>

      <div class="balance-card expense">
        <div class="balance-label">ðŸ’¸ Gastos del PerÃ­odo</div>
        <div class="balance-value">{{ formatearValor(balance.total_gastos) }}</div>
      </div>
    </div>

    <!-- Segunda fila: Balance neto y saldo final -->
    <div class="balance-cards-bottom">
      <div class="balance-card net" [class.negative]="balance.balance_neto < 0">
        <div class="balance-label">ðŸŽ¯ Balance Neto del PerÃ­odo</div>
        <div class="balance-value">{{ formatearValor(balance.balance_neto) }}</div>
        <div class="balance-sublabel">
          {{ balance.balance_neto >= 0 ? 'SuperÃ¡vit' : 'DÃ©ficit' }} del perÃ­odo
        </div>
      </div>

      <div class="balance-card final" [class.negative]="(balance.saldo_final || 0) < 0">
        <div class="balance-label">ðŸ’Ž Saldo Final</div>
        <div class="balance-value">{{ formatearValor(balance.saldo_final || 0) }}</div>
        <div class="balance-sublabel">
          Saldo anterior + Balance neto
        </div>
      </div>
    </div>
  </div>
  
  <!-- TOTALES POR DÃA -->
  <div class="totales-dia-section" *ngIf="!loading && totalesPorDia && totalesPorDia.length > 0">
    <h3 class="section-title">ðŸ“… Totales por DÃ­a</h3>

    <!-- NUEVO: Agregado (click) para abrir modal -->
    <div class="dia-item clickable" 
         *ngFor="let dia of totalesPorDia"
         (click)="mostrarMovimientosPorFecha(dia.fecha)">
      <div class="dia-fecha">
        <span class="fecha-icon">ðŸ“…</span>
        <span class="fecha-text">{{ dia.fecha | date:'dd/MM/yyyy' }}</span>
      </div>
      <div class="dia-totales">
        <div class="dia-total income">
          <span class="total-label">ðŸ’°</span>
          <span class="total-value">{{ formatearValor(dia.total_ingresos) }}</span>
          <span class="total-count">({{ dia.cantidad_ingresos }})</span>
        </div>
        <div class="dia-total expense">
          <span class="total-label">ðŸ’¸</span>
          <span class="total-value">{{ formatearValor(dia.total_gastos) }}</span>
          <span class="total-count">({{ dia.cantidad_gastos }})</span>
        </div>
      </div>
    </div>
  </div>

  <!-- TOTALES POR CATEGORÃA -->
  <div class="totales-categoria-section" *ngIf="!loading">
    <!-- INGRESOS -->
    <div class="categoria-card" *ngIf="categoriaIngresos && categoriaIngresos.length > 0">
      <h3 class="categoria-title income">ðŸ’° Ingresos por CategorÃ­a</h3>
      <div class="categoria-list">
        <!-- NUEVO: Agregado (click) para abrir modal -->
        <div class="categoria-item clickable" 
             *ngFor="let cat of categoriaIngresos"
             (click)="mostrarMovimientosPorCategoria(cat.categoria_nombre, 'Ingreso')">
          <div class="categoria-info">
            <span class="categoria-icon">{{ cat.categoria_icono }}</span>
            <div class="categoria-text">
              <div class="categoria-name">{{ cat.categoria_nombre }}</div>
              <div class="categoria-count">{{ cat.cantidad }} movimiento(s)</div>
            </div>
          </div>
          <div class="categoria-value income">{{ formatearValor(cat.total) }}</div>
        </div>
      </div>
    </div>

    <!-- GASTOS -->
    <div class="categoria-card" *ngIf="categoriaGastos && categoriaGastos.length > 0">
      <h3 class="categoria-title expense">ðŸ’¸ Gastos por CategorÃ­a</h3>
      <div class="categoria-list">
        <!-- NUEVO: Agregado (click) para abrir modal -->
        <div class="categoria-item clickable" 
             *ngFor="let cat of categoriaGastos"
             (click)="mostrarMovimientosPorCategoria(cat.categoria_nombre, 'Gasto')">
          <div class="categoria-info">
            <span class="categoria-icon">{{ cat.categoria_icono }}</span>
            <div class="categoria-text">
              <div class="categoria-name">{{ cat.categoria_nombre }}</div>
              <div class="categoria-count">{{ cat.cantidad }} movimiento(s)</div>
            </div>
          </div>
          <div class="categoria-value expense">{{ formatearValor(cat.total) }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- DETALLE POR CONCEPTO -->
  <div class="detail-section" *ngIf="!loading">
    <!-- INGRESOS -->
    <div class="detail-card" *ngIf="detalleIngresos && detalleIngresos.length > 0">
      <h3 class="detail-title income">ðŸ’° Detalle Ingresos por Concepto</h3>
      <div class="detail-list">
        <!-- NUEVO: Agregado (click) para abrir modal -->
        <div class="detail-item clickable" 
             *ngFor="let detalle of detalleIngresos"
             (click)="mostrarMovimientosPorConcepto(detalle.concepto_nombre, 'Ingreso')">
          <div class="detail-info">
            <span class="detail-icon">{{ detalle.concepto_icono }}</span>
            <div class="detail-text">
              <div class="detail-name">{{ detalle.concepto_nombre }}</div>
              <div class="detail-categoria">{{ detalle.categoria_nombre }}</div>
              <div class="detail-count">{{ detalle.cantidad }} movimiento(s)</div>
            </div>
          </div>
          <div class="detail-value income">{{ formatearValor(detalle.total) }}</div>
        </div>
      </div>
    </div>

    <!-- GASTOS -->
    <div class="detail-card" *ngIf="detalleGastos && detalleGastos.length > 0">
      <h3 class="detail-title expense">ðŸ’¸ Detalle Gastos por Concepto</h3>
      <div class="detail-list">
        <!-- NUEVO: Agregado (click) para abrir modal -->
        <div class="detail-item clickable" 
             *ngFor="let detalle of detalleGastos"
             (click)="mostrarMovimientosPorConcepto(detalle.concepto_nombre, 'Gasto')">
          <div class="detail-info">
            <span class="detail-icon">{{ detalle.concepto_icono }}</span>
            <div class="detail-text">
              <div class="detail-name">{{ detalle.concepto_nombre }}</div>
              <div class="detail-categoria">{{ detalle.categoria_nombre }}</div>
              <div class="detail-count">{{ detalle.cantidad }} movimiento(s)</div>
            </div>
          </div>
          <div class="detail-value expense">{{ formatearValor(detalle.total) }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- GRÃFICO -->
  <div class="chart-card" *ngIf="mostrarGrafico && !loading">
    <h3 class="chart-title">ðŸ“ˆ EvoluciÃ³n Mensual</h3>
    <div class="chart-container">
      <canvas #chartCanvas></canvas>
    </div>
  </div>
  
  <!-- GRÃFICO DE BARRAS POR CATEGORÃA -->
  <div class="chart-card" *ngIf="!loading && datosGraficoCategoria && datosGraficoCategoria.length > 0">
    <h3 class="chart-title">ðŸ“Š Ingresos y Gastos por CategorÃ­a</h3>
    <div class="chart-container">
      <canvas #chartBarrasCanvas></canvas>
    </div>
  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="loading-message">Cargando datos...</div>
</div>

<!-- NUEVO: Modal de movimientos -->
<app-movimientos-modal
  [movimientos]="modalMovimientos"
  [titulo]="modalTitulo"
  [subtitulo]="modalSubtitulo"
  [isOpen]="isModalOpen"
  (close)="cerrarModal()">
</app-movimientos-modal>