<div class="tab-content">
  <!-- CARDS DE BALANCE PRINCIPAL -->
  <div class="balance-summary-card">
    <h2 class="balance-summary-title accordion-header" (click)="toggleResumen()">
      <span class="accordion-icon">{{ expandirResumen ? '‚ñº' : '‚ñ∂' }}</span>
      üíº Resumen del Per√≠odo: {{ periodoTexto }}
    </h2>
    
    <div *ngIf="expandirResumen">
      <!-- Primera fila: Saldo anterior y movimientos del per√≠odo -->
      <div class="balance-cards">
        <div class="balance-card previous">
          <div class="balance-label">üíº Saldo Anterior</div>
          <div class="balance-value" [class.negative]="(balance.saldo_anterior || 0) < 0">
            {{ formatearValor(balance.saldo_anterior || 0) }}
          </div>
          <div class="balance-sublabel" *ngIf="saldoAnteriorData">
            Acumulado hasta {{ saldoAnteriorData.fecha_corte | date:'dd/MM/yyyy' }}
          </div>
        </div>

        <div class="balance-card income">
          <div class="balance-label">üí∞ Ingresos del Per√≠odo</div>
          <div class="balance-value">{{ formatearValor(balance.total_ingresos) }}</div>
        </div>

        <div class="balance-card expense">
          <div class="balance-label">üí∏ Gastos del Per√≠odo</div>
          <div class="balance-value">{{ formatearValor(balance.total_gastos) }}</div>
        </div>
      </div>

      <!-- Segunda fila: Balance neto y saldo final -->
      <div class="balance-cards-bottom">
        <div class="balance-card net" [class.negative]="balance.balance_neto < 0">
          <div class="balance-label">üéØ Balance Neto del Per√≠odo</div>
          <div class="balance-value">{{ formatearValor(balance.balance_neto) }}</div>
          <div class="balance-sublabel">
            {{ balance.balance_neto >= 0 ? 'Super√°vit' : 'D√©ficit' }} del per√≠odo
          </div>
        </div>

        <div class="balance-card final" [class.negative]="(balance.saldo_final || 0) < 0">
          <div class="balance-label">üíé Saldo Final</div>
          <div class="balance-value">{{ formatearValor(balance.saldo_final || 0) }}</div>
          <div class="balance-sublabel">
            Saldo anterior + Balance neto
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- TOTALES POR D√çA -->
  <div class="totales-dia-section" *ngIf="!loading && totalesPorDia && totalesPorDia.length > 0">
    <h3 class="section-title accordion-header" (click)="toggleTotalesDia()">
      <span class="accordion-icon">{{ expandirTotalesDia ? '‚ñº' : '‚ñ∂' }}</span>
      üìÖ Totales por D√≠a
    </h3>

    <div *ngIf="expandirTotalesDia">
      <div class="dia-item clickable" 
           *ngFor="let dia of totalesPorDia"
           (click)="mostrarMovimientosPorFecha(dia.fecha)">
        <div class="dia-fecha">
          <span class="fecha-icon">üìÖ</span>
          <span class="fecha-text">{{ dia.fecha | date:'dd/MM/yyyy' }}</span>
        </div>
        <div class="dia-totales">
          <div class="dia-total income">
            <span class="total-label">üí∞</span>
            <span class="total-value">{{ formatearValor(dia.total_ingresos) }}</span>
            <span class="total-count">({{ dia.cantidad_ingresos }})</span>
          </div>
          <div class="dia-total expense">
            <span class="total-label">üí∏</span>
            <span class="total-value">{{ formatearValor(dia.total_gastos) }}</span>
            <span class="total-count">({{ dia.cantidad_gastos }})</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- NUEVO: TOTALES POR CUENTA - DISE√ëO MEJORADO -->
  <div class="totales-cuenta-section" *ngIf="!loading && totalesPorCuenta && totalesPorCuenta.length > 0">
    <h3 class="section-title-general accordion-header" (click)="toggleCuentas()">
      <span class="accordion-icon">{{ expandirCuentas ? '‚ñº' : '‚ñ∂' }}</span>
      üí≥ Totales por Cuenta
    </h3>

    <div *ngIf="expandirCuentas" class="cuentas-grid">
      <div class="cuenta-card clickable" 
           *ngFor="let cuenta of totalesPorCuenta"
           (click)="mostrarMovimientosPorCuenta(cuenta.cuenta_id, cuenta.cuenta_nombre)">
        
        <!-- Header con icono y nombre -->
        <div class="cuenta-header">
          <span class="cuenta-icon-large">{{ cuenta.cuenta_icono }}</span>
          <div class="cuenta-info-header">
            <div class="cuenta-nombre-card">{{ cuenta.cuenta_nombre }}</div>
            <div class="cuenta-badge">{{ cuenta.cantidad_movimientos }} movimientos</div>
          </div>
        </div>

        <!-- Saldo principal -->
        <div class="cuenta-saldo-principal" [class.negative]="cuenta.saldo_actual < 0">
          <div class="saldo-label">Saldo actual</div>
          <div class="saldo-value">{{ formatearValor(cuenta.saldo_actual) }}</div>
        </div>

        <!-- Movimientos del per√≠odo: 4 cajitas -->
        <div class="cuenta-movimientos-periodo">
          <div class="movimiento-item-card ingreso">
            <span class="mov-icon">‚ÜóÔ∏è</span>
            <div class="mov-info">
              <span class="mov-label">Ingresos</span>
              <span class="mov-value">{{ formatearValor(cuenta.total_ingresos) }}</span>
            </div>
          </div>
          <div class="movimiento-item-card gasto">
            <span class="mov-icon">‚ÜòÔ∏è</span>
            <div class="mov-info">
              <span class="mov-label">Gastos</span>
              <span class="mov-value">{{ formatearValor(cuenta.total_gastos) }}</span>
            </div>
          </div>
          <div class="movimiento-item-card traslado-entrada">
            <span class="mov-icon">‚Üª</span>
            <div class="mov-info">
              <span class="mov-label">Traslado Entrada</span>
              <span class="mov-value">{{ formatearValor(cuenta.traslados_entrada) }}</span>
            </div>
          </div>
          <div class="movimiento-item-card traslado-salida">
            <span class="mov-icon">‚Üª</span>
            <div class="mov-info">
              <span class="mov-label">Traslado Salida</span>
              <span class="mov-value">{{ formatearValor(cuenta.traslados_salida) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TOTALES POR CATEGOR√çA -->
  <div class="totales-categoria-section" *ngIf="!loading">
    <h3 class="section-title-general accordion-header" (click)="toggleCategoria()">
      <span class="accordion-icon">{{ expandirCategoria ? '‚ñº' : '‚ñ∂' }}</span>
      Totales por Categor√≠a
    </h3>

    <div *ngIf="expandirCategoria">
      <!-- INGRESOS -->
      <div class="categoria-card" *ngIf="categoriaIngresos && categoriaIngresos.length > 0">
        <h3 class="categoria-title income">üí∞ Ingresos por Categor√≠a</h3>
        <div class="categoria-list">
          <div class="categoria-item clickable" 
               *ngFor="let cat of categoriaIngresos"
               (click)="mostrarMovimientosPorCategoria(cat.categoria_nombre, 'Ingreso')">
            <div class="categoria-info">
              <span class="categoria-icon">{{ cat.categoria_icono }}</span>
              <div class="categoria-text">
                <div class="categoria-name">{{ cat.categoria_nombre }}</div>
                <div class="categoria-count">{{ cat.cantidad }} movimiento(s)</div>
              </div>
            </div>
            <div class="categoria-value income">{{ formatearValor(cat.total) }}</div>
          </div>
        </div>
      </div>

      <!-- GASTOS -->
      <div class="categoria-card" *ngIf="categoriaGastos && categoriaGastos.length > 0">
        <h3 class="categoria-title expense">üí∏ Gastos por Categor√≠a</h3>
        <div class="categoria-list">
          <div class="categoria-item clickable" 
               *ngFor="let cat of categoriaGastos"
               (click)="mostrarMovimientosPorCategoria(cat.categoria_nombre, 'Gasto')">
            <div class="categoria-info">
              <span class="categoria-icon">{{ cat.categoria_icono }}</span>
              <div class="categoria-text">
                <div class="categoria-name">{{ cat.categoria_nombre }}</div>
                <div class="categoria-count">{{ cat.cantidad }} movimiento(s)</div>
              </div>
            </div>
            <div class="categoria-value expense">{{ formatearValor(cat.total) }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DETALLE POR CONCEPTO -->
  <div class="detail-section" *ngIf="!loading">
    <h3 class="section-title-general accordion-header" (click)="toggleDetalle()">
      <span class="accordion-icon">{{ expandirDetalle ? '‚ñº' : '‚ñ∂' }}</span>
      Detalle por Concepto
    </h3>

    <div *ngIf="expandirDetalle">
      <!-- INGRESOS -->
      <div class="detail-card" *ngIf="detalleIngresos && detalleIngresos.length > 0">
        <h3 class="detail-title income">üí∞ Detalle Ingresos por Concepto</h3>
        <div class="detail-list">
          <div class="detail-item clickable" 
               *ngFor="let detalle of detalleIngresos"
               (click)="mostrarMovimientosPorConcepto(detalle.concepto_nombre, 'Ingreso')">
            <div class="detail-info">
              <span class="detail-icon">{{ detalle.concepto_icono }}</span>
              <div class="detail-text">
                <div class="detail-name">{{ detalle.concepto_nombre }}</div>
                <div class="detail-categoria">{{ detalle.categoria_nombre }}</div>
                <div class="detail-count">{{ detalle.cantidad }} movimiento(s)</div>
              </div>
            </div>
            <div class="detail-value income">{{ formatearValor(detalle.total) }}</div>
          </div>
        </div>
      </div>

      <!-- GASTOS -->
      <div class="detail-card" *ngIf="detalleGastos && detalleGastos.length > 0">
        <h3 class="detail-title expense">üí∏ Detalle Gastos por Concepto</h3>
        <div class="detail-list">
          <div class="detail-item clickable" 
               *ngFor="let detalle of detalleGastos"
               (click)="mostrarMovimientosPorConcepto(detalle.concepto_nombre, 'Gasto')">
            <div class="detail-info">
              <span class="detail-icon">{{ detalle.concepto_icono }}</span>
              <div class="detail-text">
                <div class="detail-name">{{ detalle.concepto_nombre }}</div>
                <div class="detail-categoria">{{ detalle.categoria_nombre }}</div>
                <div class="detail-count">{{ detalle.cantidad }} movimiento(s)</div>
              </div>
            </div>
            <div class="detail-value expense">{{ formatearValor(detalle.total) }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- GR√ÅFICO -->
  <div class="chart-card" *ngIf="mostrarGrafico && !loading">
    <h3 class="chart-title accordion-header" (click)="toggleGraficoEvolucion()">
      <span class="accordion-icon">{{ expandirGraficoEvolucion ? '‚ñº' : '‚ñ∂' }}</span>
      üìà Evoluci√≥n Mensual
    </h3>
    <div class="chart-container" *ngIf="expandirGraficoEvolucion">
      <canvas #chartCanvas></canvas>
    </div>
  </div>
  
  <!-- GR√ÅFICO DE BARRAS POR CATEGOR√çA -->
  <div class="chart-card" *ngIf="!loading && datosGraficoCategoria && datosGraficoCategoria.length > 0">
    <h3 class="chart-title accordion-header" (click)="toggleGraficoCategoria()">
      <span class="accordion-icon">{{ expandirGraficoCategoria ? '‚ñº' : '‚ñ∂' }}</span>
      üìä Ingresos y Gastos por Categor√≠a
    </h3>
    <div class="chart-container" *ngIf="expandirGraficoCategoria">
      <canvas #chartBarrasCanvas></canvas>
    </div>
  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="loading-message">Cargando datos...</div>
</div>

<!-- Modal de movimientos -->
<app-movimientos-modal
  [movimientos]="modalMovimientos"
  [titulo]="modalTitulo"
  [subtitulo]="modalSubtitulo"
  [isOpen]="isModalOpen"
  (close)="cerrarModal()">
</app-movimientos-modal>