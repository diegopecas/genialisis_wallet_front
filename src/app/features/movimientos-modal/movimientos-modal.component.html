<div class="modal-overlay" 
     *ngIf="isOpen" 
     (click)="onOverlayClick($event)">
  
  <div class="modal-content">
    <!-- Header -->
    <div class="modal-header">
      <div class="modal-title-section">
        <h2 class="modal-title">{{ titulo }}</h2>
        <p class="modal-subtitle" *ngIf="subtitulo">{{ subtitulo }}</p>
      </div>
      <button class="modal-close-btn" (click)="onClose()" aria-label="Cerrar">
        <span>‚úï</span>
      </button>
    </div>

    <!-- NUEVO: B√∫squeda -->
    <div class="modal-search">
      <div class="search-input-wrapper">
        <span class="search-icon">üîç</span>
        <input 
          type="text" 
          class="search-input"
          placeholder="Buscar por concepto, categor√≠a o detalle..."
          [(ngModel)]="busqueda"
          (ngModelChange)="onBusquedaChange()">
        <button 
          *ngIf="busqueda" 
          class="clear-btn" 
          (click)="limpiarBusqueda()"
          aria-label="Limpiar">
          ‚úï
        </button>
      </div>
    </div>

    <!-- Body -->
    <div class="modal-body">
      <!-- Totales -->
      <div class="totales-resumen">
        <div class="total-badge ingreso" *ngIf="ingresos.length > 0">
          <span class="badge-icon">üí∞</span>
          <span class="badge-text">{{ ingresos.length }} Ingreso(s)</span>
          <span class="badge-value">{{ formatearValor(totalIngresos) }}</span>
        </div>
        <div class="total-badge gasto" *ngIf="gastos.length > 0">
          <span class="badge-icon">üí∏</span>
          <span class="badge-text">{{ gastos.length }} Gasto(s)</span>
          <span class="badge-value">{{ formatearValor(totalGastos) }}</span>
        </div>
        <div class="total-badge traslado" *ngIf="traslados.length > 0">
          <span class="badge-icon">‚Üª</span>
          <span class="badge-text">{{ traslados.length }} Traslado(s)</span>
          <span class="badge-value">{{ formatearValor(totalTraslados) }}</span>
        </div>
      </div>

      <!-- INGRESOS -->
      <div class="movimientos-section" *ngIf="ingresos.length > 0">
        <h3 class="section-header ingreso">
          <span class="header-icon">üí∞</span>
          Ingresos ({{ ingresos.length }})
        </h3>
        <div class="movimientos-list">
          <div class="movimiento-item ingreso" *ngFor="let mov of ingresos">
            <div class="movimiento-icon">{{ mov.concepto_icono }}</div>
            
            <div class="movimiento-info">
              <div class="movimiento-concepto">{{ mov.concepto_nombre }}</div>
              <div class="movimiento-categoria">
                <span class="categoria-icon">{{ mov.categoria_icono }}</span>
                {{ mov.categoria_nombre }}
              </div>
              <div class="movimiento-fecha">{{ mov.fecha | date:'dd/MM/yyyy' }}</div>
              <div class="movimiento-detalle" *ngIf="mov.detalle">{{ mov.detalle }}</div>
            </div>
            
            <div class="movimiento-valor ingreso">
              {{ formatearValor(mov.valor) }}
            </div>
          </div>
        </div>
      </div>

      <!-- GASTOS -->
      <div class="movimientos-section" *ngIf="gastos.length > 0">
        <h3 class="section-header gasto">
          <span class="header-icon">üí∏</span>
          Gastos ({{ gastos.length }})
        </h3>
        <div class="movimientos-list">
          <div class="movimiento-item gasto" *ngFor="let mov of gastos">
            <div class="movimiento-icon">{{ mov.concepto_icono }}</div>
            
            <div class="movimiento-info">
              <div class="movimiento-concepto">{{ mov.concepto_nombre }}</div>
              <div class="movimiento-categoria">
                <span class="categoria-icon">{{ mov.categoria_icono }}</span>
                {{ mov.categoria_nombre }}
              </div>
              <div class="movimiento-fecha">{{ mov.fecha | date:'dd/MM/yyyy' }}</div>
              <div class="movimiento-detalle" *ngIf="mov.detalle">{{ mov.detalle }}</div>
            </div>
            
            <div class="movimiento-valor gasto">
              {{ formatearValor(mov.valor) }}
            </div>
          </div>
        </div>
      </div>

      <!-- TRASLADOS -->
      <div class="movimientos-section" *ngIf="traslados.length > 0">
        <h3 class="section-header traslado">
          <span class="header-icon">‚Üª</span>
          Traslados ({{ traslados.length }})
        </h3>
        <div class="movimientos-list">
          <div class="movimiento-item traslado" *ngFor="let mov of traslados">
            <div class="movimiento-icon">‚Üª</div>
            
            <div class="movimiento-info">
              <div class="movimiento-concepto">{{ mov.cuenta_origen_nombre }} ‚Üí {{ mov.cuenta_destino_nombre }}</div>
              <div class="movimiento-categoria">
                <span class="categoria-icon">{{ mov.categoria_icono }}</span>
                {{ mov.categoria_nombre }}
              </div>
              <div class="movimiento-fecha">{{ mov.fecha | date:'dd/MM/yyyy' }}</div>
              <div class="movimiento-detalle" *ngIf="mov.detalle">{{ mov.detalle }}</div>
            </div>
            
            <div class="movimiento-valor traslado">
              {{ formatearValor(mov.valor) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="ingresos.length === 0 && gastos.length === 0 && traslados.length === 0">
        <div class="empty-icon">üîç</div>
        <p *ngIf="busqueda">No se encontraron movimientos que coincidan con "{{ busqueda }}"</p>
        <p *ngIf="!busqueda">No hay movimientos para mostrar</p>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="btn-cerrar" (click)="onClose()">Cerrar</button>
    </div>
  </div>
</div>